<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="chrome=1"><meta name=HandheldFriendly content="True"><meta name=MobileOptimized content="320"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><meta name=description content="Deprecation: See /posts/movie-pilot/
NasTool Initialization The following content only introduces to user who manually oragnize media files like me.
Preparation Applying the TMDB API key at https://www.themoviedb.org/settings/api Documentation: https://developer.themoviedb.org/reference/intro/getting-started Installation For Docker on DSM users, create a container according to the following Docker command:
docker run -d \ --name nas-tools \ --hostname nas-tools \ -p 3000:3000 \ -v $(pwd)/config:/config \ -v /外部媒体目录:/media \ -e REPO_URL=&#34;https://ghproxy.com/https://github.com/hsuyelin/nas-tools.git&#34; -e PUID=0 \ -e PGID=0 \ -e UMASK=000 \ -e NASTOOL_AUTO_UPDATE=false \ -e NASTOOL_CN_UPDATE=true \ hsuyelin/nas-tools The downloaded media will be stored at /media/Movie/ and /media/TV/."><meta property="og:title" content="NasTool and Hard Links"><meta property="og:description" content="Deprecation: See /posts/movie-pilot/
NasTool Initialization The following content only introduces to user who manually oragnize media files like me.
Preparation Applying the TMDB API key at https://www.themoviedb.org/settings/api Documentation: https://developer.themoviedb.org/reference/intro/getting-started Installation For Docker on DSM users, create a container according to the following Docker command:
docker run -d \ --name nas-tools \ --hostname nas-tools \ -p 3000:3000 \ -v $(pwd)/config:/config \ -v /外部媒体目录:/media \ -e REPO_URL=&#34;https://ghproxy.com/https://github.com/hsuyelin/nas-tools.git&#34; -e PUID=0 \ -e PGID=0 \ -e UMASK=000 \ -e NASTOOL_AUTO_UPDATE=false \ -e NASTOOL_CN_UPDATE=true \ hsuyelin/nas-tools The downloaded media will be stored at /media/Movie/ and /media/TV/."><meta property="og:type" content="article"><meta property="og:url" content="/posts/nastool-and-hard-link/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-05-13T15:57:11+08:00"><meta property="article:modified_time" content="2024-05-13T15:57:11+08:00"><title>NasTool and Hard Links</title><link rel=canonical href=/posts/nastool-and-hard-link/><script async src="https://www.googletagmanager.com/gtag/js?id=UA-66839894-6"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","UA-66839894-6")</script><style type=text/css>pre{width:100%;overflow:hidden}img{max-width:90%}h2{color:#b3befe}a{color:#aaa;text-decoration:none}a:hover{text-decoration:underline}li.post-item{color:#6b6f84}li.post-item .meta{font-size:85%;padding-right:2px}li.post-item a{font-family:monospace;font-size:110%;color:#b3befe}body{background-color:#333;color:#eee}pre{background-color:#272822}code{max-width:98%;text-wrap-mode:wrap}footer{color:#555}header h1{text-transform:uppercase;font-family:monospace;background:#3facfe;color:rgba(255,255,255,.8);display:inline-block;margin:2px;padding:0 8px}</style></head><body lang><section class="main post"><div class=container><div class=content><div class=front-matter><div class=title-container><h2>NasTool and Hard Links</h2></div><div class=meta><div class=date title='Mon May 13 2024 15:57:11 +0800'>May 13, 2024</div><div class=reading-time><div class=middot></div></div></div></div><div class=markdown><blockquote><p>Deprecation: See <a href=/posts/movie-pilot/>/posts/movie-pilot/</a></p></blockquote><h1 id=nastool>NasTool</h1><h2 id=initialization>Initialization</h2><p>The following content only introduces to user who manually oragnize media files like me.</p><h3 id=preparation>Preparation</h3><ul><li>Applying the TMDB API key at <a href=https://www.themoviedb.org/settings/api>https://www.themoviedb.org/settings/api</a></li><li>Documentation: <a href=https://developer.themoviedb.org/reference/intro/getting-started>https://developer.themoviedb.org/reference/intro/getting-started</a></li></ul><h3 id=installation>Installation</h3><p>For Docker on DSM users, create a container according to the following Docker command:</p><pre tabindex=0><code>docker run -d \
  --name nas-tools \
  --hostname nas-tools \
  -p 3000:3000 \
  -v $(pwd)/config:/config \
  -v /外部媒体目录:/media \
  -e REPO_URL=&#34;https://ghproxy.com/https://github.com/hsuyelin/nas-tools.git&#34;
  -e PUID=0 \
  -e PGID=0 \
  -e UMASK=000 \
  -e NASTOOL_AUTO_UPDATE=false \
  -e NASTOOL_CN_UPDATE=true \
  hsuyelin/nas-tools
</code></pre><p>The downloaded media will be stored at /media/Movie/ and /media/TV/.</p><h3 id=my-configuration>My Configuration</h3><ul><li>TMDB API Key: (fill in)</li><li>二级分类策略: disabled</li><li>默认文件转移方式: hard link</li><li>转移最小文件大小(MB): 50</li><li>电影重命名格式: {title} ({year}) TM{tmdbid}/{title}-{part} ({year}) - {videoFormat}</li><li>电视剧重命名格式: {title} ({year}) TM{tmdbid}/S{season}/{season_episode} - {title}-{part}</li><li>刮削元数据及图片: enabled</li><li>使用横杠替换冒号: enabled</li><li>媒体库<ul><li>电影: /media/_result/Movie/</li><li>电视剧: /media/_result/TV/</li></ul></li></ul><h3 id=notification-webhook>Notification (Webhook)</h3><p>Create an API to accept the following test case:</p><pre tabindex=0><code>http POST $(uri)/nastool Content-Type:application/json title=&#39;Everybody Loves Raymond (1996) S01 E01 已入库&#39; text=&#39;评分：6.8，类型：电视剧，质量： DVD，发布组/字幕组：rmvb，大小：101.45M，来自：手动整理&#39; image=&#39;https://assets.fanart.tv/fanart/tv/73663/tvthumb/everybody-loves-raymond-5ae9af7c081c4.jpg&#39; url=&#39;&#39; user_id=&#39;&#39;
</code></pre><h2 id=getting-started>Getting Started</h2><p>Go to 媒体整理-文件管理, find the download folder that you mounted, and start organizing.</p><h1 id=hard-links>Hard Links</h1><p>There might be some questions that you will be faced with and need to be figured out if you don&rsquo;t want to fuck up filesystem as a long-term user when using NasTool to organize TV shows and movies. For example, what if I need to move things to another partition?</p><h2 id=what-if-i-have-a-file-and-a-hard-link-point-to-this-file-then-i-moved-the-hard-link-to-another-partition-will-this-hard-link-be-a-invalid-link-or-an-actual-file>What if I have a file and a hard link point to this file, then I moved the hard link to another partition. Will this hard link be a invalid link or an actual file?</h2><ul><li>If the move operation is within the same file system, the hard link will remain valid. It will still point to the same data, and you can access the file using either the original file path or the hard link path.</li><li>If the move operation is across different partitions, the hard link will become a normal file on the destination partition. It will no longer point to the original file&rsquo;s data. Instead, it will be an independent file that contains a copy of the original file&rsquo;s data at the time of the move. The hard link will be separate from the original file, and changes made to one will not affect the other.</li></ul><h2 id=what-happens-if-i-move-this-file-and-the-hard-link-both-to-another-partition-will-this-hard-link-still-work-or-will-there-be-two-independent-files>What happens if I move this file and the hard link both to another partition? Will this hard link still work? Or will there be two independent files?</h2><ul><li>For filesystems like NTFS, ext4 and btrfs that does not support hard links across partitions, the hard link will become a separate, independent file on the destination partition. It will no longer be a hard link, but rather a regular file that contains a copy of the original file&rsquo;s data at the time. The original file will also exist as an independent file on the destination partition.</li></ul><h2 id=how-to-copy-folders-with-preserving-hardlinks>How to copy folders with preserving hardlinks?</h2><p>rsync has a -H or &ndash;hard-links option for this:</p><blockquote><p>-H, &ndash;hard-links</p></blockquote><blockquote><p>This tells rsync to look for hard-linked files in the source and link together the corresponding files on the destination. Without this option, hard-linked files in the source are treated as though they were separate files.</p></blockquote><br><p class=back-to-posts><a href=/>[back]</a></p></div><br></div></div></section>