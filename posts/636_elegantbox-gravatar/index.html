<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="chrome=1"><meta name=HandheldFriendly content="True"><meta name=MobileOptimized content="320"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><meta name=description content="以下内容恢复自 Wordpress 时期的数据库备份，内容已经严重过期，仅留作纪念。 打开主题目录里的主题支持函数 functions.php 文件，然后开始看代码
<?php // WordPress 2.5 or higher if (function_exists('get_avatar') && get_option('show_avatars')) { echo '<div class=\&#34;userpic\&#34;>'; echo get_avatar($comment, 24); echo '</div>'; // WordPress 2.3.3 or lower } else if (function_exists('gravatar')) { echo '<div class=\&#34;userpic\&#34;><img class=\&#34;avatar\&#34; src=\&#34;'; gravatar(\&#34;G\&#34;, 24); echo '\&#34; alt=\&#34;avatar\&#34; /></div>'; } ?> 这里和 iNove 完全不一样，所以要做如下修改
<?php // WordPress 2.5 or higher if (function_exists('get_avatar') && get_option('show_avatars')) { echo '<div class=\&#34;userpic\&#34;> <img src=\&#34;你的头像缓存目录/cache/avatar/'. md5(strtolower($comment->comment_author_email)) .'\&#34; alt=\&#34;\&#34; height=\&#34;24\&#34; width=\&#34;24\&#34; /></div>'; // WordPress 2."><meta property="og:title" content="给 ElegantBox 缓存评论头像"><meta property="og:description" content="以下内容恢复自 Wordpress 时期的数据库备份，内容已经严重过期，仅留作纪念。 打开主题目录里的主题支持函数 functions.php 文件，然后开始看代码
<?php // WordPress 2.5 or higher if (function_exists('get_avatar') && get_option('show_avatars')) { echo '<div class=\&#34;userpic\&#34;>'; echo get_avatar($comment, 24); echo '</div>'; // WordPress 2.3.3 or lower } else if (function_exists('gravatar')) { echo '<div class=\&#34;userpic\&#34;><img class=\&#34;avatar\&#34; src=\&#34;'; gravatar(\&#34;G\&#34;, 24); echo '\&#34; alt=\&#34;avatar\&#34; /></div>'; } ?> 这里和 iNove 完全不一样，所以要做如下修改
<?php // WordPress 2.5 or higher if (function_exists('get_avatar') && get_option('show_avatars')) { echo '<div class=\&#34;userpic\&#34;> <img src=\&#34;你的头像缓存目录/cache/avatar/'. md5(strtolower($comment->comment_author_email)) .'\&#34; alt=\&#34;\&#34; height=\&#34;24\&#34; width=\&#34;24\&#34; /></div>'; // WordPress 2."><meta property="og:type" content="article"><meta property="og:url" content="/posts/636_elegantbox-gravatar/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2009-10-26T22:27:50+08:00"><meta property="article:modified_time" content="2009-10-26T22:27:50+08:00"><title>给 ElegantBox 缓存评论头像</title><link rel=canonical href=/posts/636_elegantbox-gravatar/><script async src="https://www.googletagmanager.com/gtag/js?id=UA-66839894-6"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","UA-66839894-6")</script><style type=text/css>pre{width:100%;overflow:hidden}img{max-width:90%}</style></head><body lang><section class="main post"><div class=container><div class=content><div class=front-matter><div class=title-container><h2>给 ElegantBox 缓存评论头像</h2></div><div class=meta><div class=date title='Mon Oct 26 2009 22:27:50 +0800'>Oct 26, 2009</div><div class=reading-time><div class=middot></div></div></div></div><div class=markdown><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>以下内容恢复自 Wordpress 时期的数据库备份，内容已经严重过期，仅留作纪念。
</span></span></code></pre></div><p>打开主题目录里的主题支持函数 functions.php 文件，然后开始看代码</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// WordPress 2.5 or higher
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>function_exists</span>(<span style=color:#e6db74>&#39;get_avatar&#39;</span>) <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>get_option</span>(<span style=color:#e6db74>&#39;show_avatars&#39;</span>)) {
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>echo</span> <span style=color:#e6db74>&#39;&lt;div class=\&#34;userpic\&#34;&gt;&#39;</span>; <span style=color:#66d9ef>echo</span> <span style=color:#a6e22e>get_avatar</span>($comment, <span style=color:#ae81ff>24</span>); <span style=color:#66d9ef>echo</span> <span style=color:#e6db74>&#39;&lt;/div&gt;&#39;</span>;
</span></span><span style=display:flex><span>		<span style=color:#75715e>// WordPress 2.3.3 or lower
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	} <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>function_exists</span>(<span style=color:#e6db74>&#39;gravatar&#39;</span>)) {
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>echo</span> <span style=color:#e6db74>&#39;&lt;div class=\&#34;userpic\&#34;&gt;&lt;img class=\&#34;avatar\&#34; src=\&#34;&#39;</span>;
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>gravatar</span>(<span style=color:#a6e22e>\</span><span style=color:#e6db74>&#34;G</span><span style=color:#ae81ff>\&#34;</span><span style=color:#e6db74>, 24); echo &#39;</span><span style=color:#ae81ff>\&#34;</span><span style=color:#e6db74> alt=</span><span style=color:#ae81ff>\&#34;</span><span style=color:#e6db74>avatar</span><span style=color:#ae81ff>\&#34;</span><span style=color:#e6db74> /&gt;&lt;/div&gt;&#39;;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>	}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>?&gt;
</span></span></span></code></pre></div><p>这里和 iNove 完全不一样，所以要做如下修改</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// WordPress 2.5 or higher
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>function_exists</span>(<span style=color:#e6db74>&#39;get_avatar&#39;</span>) <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>get_option</span>(<span style=color:#e6db74>&#39;show_avatars&#39;</span>)) {
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>echo</span> <span style=color:#e6db74>&#39;&lt;div class=\&#34;userpic\&#34;&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>		&lt;img src=\&#34;你的头像缓存目录/cache/avatar/&#39;</span><span style=color:#f92672>.</span>
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>md5</span>(<span style=color:#a6e22e>strtolower</span>($comment<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>comment_author_email</span>)) <span style=color:#f92672>.</span><span style=color:#e6db74>&#39;\&#34; alt=\&#34;\&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>		height=\&#34;24\&#34; width=\&#34;24\&#34; /&gt;&lt;/div&gt;&#39;</span>;
</span></span><span style=display:flex><span>		<span style=color:#75715e>// WordPress 2.3.3 or lower
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	} <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>function_exists</span>(<span style=color:#e6db74>&#39;gravatar&#39;</span>)) {
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>echo</span> <span style=color:#e6db74>&#39;&lt;div class=\&#34;userpic\&#34;&gt;&lt;img class=\&#34;avatar\&#34; src=\&#34;&#39;</span>;
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>gravatar</span>(<span style=color:#a6e22e>\</span><span style=color:#e6db74>&#34;G</span><span style=color:#ae81ff>\&#34;</span><span style=color:#e6db74>, 24); echo &#39;</span><span style=color:#ae81ff>\&#34;</span><span style=color:#e6db74> alt=</span><span style=color:#ae81ff>\&#34;</span><span style=color:#e6db74>avatar</span><span style=color:#ae81ff>\&#34;</span><span style=color:#e6db74> /&gt;&lt;/div&gt;&#39;;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>	}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>?&gt;
</span></span></span></code></pre></div><p>在这里是无法使用 $mail 的，我们要用 $comment->comment_author_email</p><p>完工了 ~~</p><br><p class=back-to-posts><a href=/>[back]</a></p></div><br></div></div></section>