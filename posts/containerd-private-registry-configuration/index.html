<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="chrome=1"><meta name=HandheldFriendly content="True"><meta name=MobileOptimized content="320"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><meta name=description content="For instance, the URI of private registry: registry.legacy.
Edit /etc/hosts if necessary. After that, create a template configuration file for Containerd.
sudo cp /var/lib/rancher/k3s/agent/etc/containerd/config.toml /var/lib/rancher/k3s/agent/etc/containerd/config.toml.tmpl Append private registry configuration to the file above.
sudo vim /var/lib/rancher/k3s/agent/etc/containerd/config.toml.tmpl [plugins.cri.registry.mirrors] [plugins.cri.registry.mirrors.&#34;registry.legacy&#34;] endpoint = [&#34;http://registry.legacy&#34;] Restart k3s.
sudo systemctl restart k3s "><meta property="og:title" content="Containerd Private Registry Configuration"><meta property="og:description" content="For instance, the URI of private registry: registry.legacy.
Edit /etc/hosts if necessary. After that, create a template configuration file for Containerd.
sudo cp /var/lib/rancher/k3s/agent/etc/containerd/config.toml /var/lib/rancher/k3s/agent/etc/containerd/config.toml.tmpl Append private registry configuration to the file above.
sudo vim /var/lib/rancher/k3s/agent/etc/containerd/config.toml.tmpl [plugins.cri.registry.mirrors] [plugins.cri.registry.mirrors.&#34;registry.legacy&#34;] endpoint = [&#34;http://registry.legacy&#34;] Restart k3s.
sudo systemctl restart k3s "><meta property="og:type" content="article"><meta property="og:url" content="/posts/containerd-private-registry-configuration/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2021-03-11T17:14:30+08:00"><meta property="article:modified_time" content="2021-03-11T17:14:30+08:00"><title>Containerd Private Registry Configuration</title><link rel=canonical href=/posts/containerd-private-registry-configuration/><script async src="https://www.googletagmanager.com/gtag/js?id=UA-66839894-6"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","UA-66839894-6")</script><style type=text/css>pre{width:100%;overflow:hidden}img{max-width:90%}h2{color:#b3befe;text-transform:uppercase;font-family:fangsong,sans-serif}a{color:#aaa;text-decoration:none}a:hover{text-decoration:underline}ul{padding:0 8px}li.post-item{color:#6b6f84;list-style:none}li.post-item .meta{font-size:85%;padding-right:6px;font-family:monospace;display:inline-block;width:8em;text-align:right}li.post-item a{font-family:monospace;font-size:110%;color:#b3befe}li.post-item.no-bullet{padding-top:8px}body{background-color:#333;color:#eee}pre{background-color:#272822}code{max-width:98%;text-wrap-mode:wrap}footer{color:#555}header h1{text-transform:uppercase;font-family:fangsong,sans-serif;border-left:3px solid #3facfe;color:rgba(255,255,255,.8);display:inline-block;margin:2px;padding:0 8px}</style></head><body lang><section class="main post"><div class=container><div class=content><div class=front-matter><div class=title-container><h2>Containerd Private Registry Configuration</h2></div><div class=meta><div class=date title='Thu Mar 11 2021 17:14:30 +0800'>Mar 11, 2021</div><div class=reading-time><div class=middot></div></div></div></div><div class=markdown><p>For instance, the URI of private registry: <code>registry.legacy</code>.</p><p>Edit <code>/etc/hosts</code> if necessary. After that, create a template configuration file for Containerd.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo cp /var/lib/rancher/k3s/agent/etc/containerd/config.toml /var/lib/rancher/k3s/agent/etc/containerd/config.toml.tmpl
</span></span></code></pre></div><p>Append private registry configuration to the file above.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo vim /var/lib/rancher/k3s/agent/etc/containerd/config.toml.tmpl
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-toml data-lang=toml><span style=display:flex><span>[<span style=color:#a6e22e>plugins</span>.<span style=color:#a6e22e>cri</span>.<span style=color:#a6e22e>registry</span>.<span style=color:#a6e22e>mirrors</span>]
</span></span><span style=display:flex><span>[<span style=color:#a6e22e>plugins</span>.<span style=color:#a6e22e>cri</span>.<span style=color:#a6e22e>registry</span>.<span style=color:#a6e22e>mirrors</span>.<span style=color:#e6db74>&#34;registry.legacy&#34;</span>]
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>endpoint</span> = [<span style=color:#e6db74>&#34;http://registry.legacy&#34;</span>]
</span></span></code></pre></div><p>Restart k3s.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo systemctl restart k3s
</span></span></code></pre></div><br><p class=back-to-posts><a href=/>[back]</a></p></div><br></div></div></section>