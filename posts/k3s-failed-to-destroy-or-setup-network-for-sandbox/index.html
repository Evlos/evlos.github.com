<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="chrome=1"><meta name=HandheldFriendly content="True"><meta name=MobileOptimized content="320"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><meta name=description content="Issue: failed to destroy network for sandbox Aug 30 16:33:45 k8s k3s[3407]: E0830 16:33:45.180187 3407 kuberuntime_manager.go:1075] &#34;killPodWithSyncResult failed&#34; err=&#34;failed to \&#34;KillPodSandbox\&#34; for \&#34;fadedcde-ce8d-42cc-8467-a8d5bb826fce\&#34; with KillP Aug 30 16:33:45 k8s k3s[3407]: E0830 16:33:45.180300 3407 pod_workers.go:1300] &#34;Error syncing pod, skipping&#34; err=&#34;failed to \&#34;KillPodSandbox\&#34; for \&#34;fadedcde-ce8d-42cc-8467-a8d5bb826fce\&#34; with KillPodSandbox Aug 30 16:33:45 k8s k3s[3407]: E0830 16:33:45.182928 3407 remote_runtime.go:222] &#34;StopPodSandbox from runtime service failed&#34; err=&#34;rpc error: code = Unknown desc = failed to destroy network for sandbox \&#34;cb4 Aug 30 16:33:45 k8s k3s[3407]: E0830 16:33:45."><meta property="og:title" content="K3s failed to destroy or setup network for sandbox"><meta property="og:description" content="Issue: failed to destroy network for sandbox Aug 30 16:33:45 k8s k3s[3407]: E0830 16:33:45.180187 3407 kuberuntime_manager.go:1075] &#34;killPodWithSyncResult failed&#34; err=&#34;failed to \&#34;KillPodSandbox\&#34; for \&#34;fadedcde-ce8d-42cc-8467-a8d5bb826fce\&#34; with KillP Aug 30 16:33:45 k8s k3s[3407]: E0830 16:33:45.180300 3407 pod_workers.go:1300] &#34;Error syncing pod, skipping&#34; err=&#34;failed to \&#34;KillPodSandbox\&#34; for \&#34;fadedcde-ce8d-42cc-8467-a8d5bb826fce\&#34; with KillPodSandbox Aug 30 16:33:45 k8s k3s[3407]: E0830 16:33:45.182928 3407 remote_runtime.go:222] &#34;StopPodSandbox from runtime service failed&#34; err=&#34;rpc error: code = Unknown desc = failed to destroy network for sandbox \&#34;cb4 Aug 30 16:33:45 k8s k3s[3407]: E0830 16:33:45."><meta property="og:type" content="article"><meta property="og:url" content="/posts/k3s-failed-to-destroy-or-setup-network-for-sandbox/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-09-05T22:20:08+08:00"><meta property="article:modified_time" content="2024-09-05T22:20:08+08:00"><title>K3s failed to destroy or setup network for sandbox</title><link rel=canonical href=/posts/k3s-failed-to-destroy-or-setup-network-for-sandbox/><script async src="https://www.googletagmanager.com/gtag/js?id=UA-66839894-6"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","UA-66839894-6")</script><style type=text/css>pre{width:100%;overflow:hidden}img{max-width:90%}a{color:#aaa}li.post-item .meta{font-size:90%}li.post-item{color:#777}body{background-color:#333;color:#eee}pre{background-color:#272822}code{max-width:98%;text-wrap-mode:wrap}footer{color:#555}</style></head><body lang><section class="main post"><div class=container><div class=content><div class=front-matter><div class=title-container><h2>K3s failed to destroy or setup network for sandbox</h2></div><div class=meta><div class=date title='Thu Sep 5 2024 22:20:08 +0800'>Sep 5, 2024</div><div class=reading-time><div class=middot></div></div></div></div><div class=markdown><h2 id=issue-failed-to-destroy-network-for-sandbox>Issue: failed to destroy network for sandbox</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>Aug <span style=color:#ae81ff>30</span> 16:33:45 k8s k3s<span style=color:#f92672>[</span>3407<span style=color:#f92672>]</span>: E0830 16:33:45.180187    <span style=color:#ae81ff>3407</span> kuberuntime_manager.go:1075<span style=color:#f92672>]</span> <span style=color:#e6db74>&#34;killPodWithSyncResult failed&#34;</span> err<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;failed to \&#34;KillPodSandbox\&#34; for \&#34;fadedcde-ce8d-42cc-8467-a8d5bb826fce\&#34; with KillP
</span></span></span><span style=display:flex><span><span style=color:#e6db74>Aug 30 16:33:45 k8s k3s[3407]: E0830 16:33:45.180300    3407 pod_workers.go:1300] &#34;</span>Error syncing pod, skipping<span style=color:#e6db74>&#34; err=&#34;</span>failed to <span style=color:#ae81ff>\&#34;</span>KillPodSandbox<span style=color:#ae81ff>\&#34;</span> <span style=color:#66d9ef>for</span> <span style=color:#ae81ff>\&#34;</span>fadedcde-ce8d-42cc-8467-a8d5bb826fce<span style=color:#ae81ff>\&#34;</span> with KillPodSandbox
</span></span><span style=display:flex><span>Aug <span style=color:#ae81ff>30</span> 16:33:45 k8s k3s<span style=color:#f92672>[</span>3407<span style=color:#f92672>]</span>: E0830 16:33:45.182928    <span style=color:#ae81ff>3407</span> remote_runtime.go:222<span style=color:#f92672>]</span> <span style=color:#e6db74>&#34;StopPodSandbox from runtime service failed&#34;</span> err<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;rpc error: code = Unknown desc = failed to destroy network for sandbox \&#34;cb4
</span></span></span><span style=display:flex><span><span style=color:#e6db74>Aug 30 16:33:45 k8s k3s[3407]: E0830 16:33:45.183053    3407 kuberuntime_manager.go:1375] &#34;</span>Failed to stop sandbox<span style=color:#e6db74>&#34; podSandboxID={&#34;</span>Type<span style=color:#e6db74>&#34;:&#34;</span>containerd<span style=color:#e6db74>&#34;,&#34;</span>ID<span style=color:#e6db74>&#34;:&#34;</span>cb4e620aa2a90ea1a358bc214a5c87015a398159ac5d934dd24aef5
</span></span><span style=display:flex><span>Aug <span style=color:#ae81ff>30</span> 16:33:45 k8s k3s<span style=color:#f92672>[</span>3407<span style=color:#f92672>]</span>: E0830 16:33:45.183182    <span style=color:#ae81ff>3407</span> kuberuntime_manager.go:1075<span style=color:#f92672>]</span> <span style=color:#e6db74>&#34;killPodWithSyncResult failed&#34;</span> err<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;failed to \&#34;KillPodSandbox\&#34; for \&#34;7c96104e-de03-4c26-bf41-28e9cae1f015\&#34; with KillP
</span></span></span></code></pre></div><h3 id=solution>Solution</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>k3s-killall.sh
</span></span><span style=display:flex><span>rm -rf /var/lib/cni
</span></span><span style=display:flex><span>sudo systemctl start k3s
</span></span></code></pre></div><h2 id=issue-failed-to-setup-network-for-sandbox>Issue: failed to setup network for sandbox</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>Warning  FailedCreatePodSandBox  15s               kubelet            Failed to create pod sandbox: rpc error: code <span style=color:#f92672>=</span> Unknown desc <span style=color:#f92672>=</span> failed to setup network <span style=color:#66d9ef>for</span> sandbox <span style=color:#e6db74>&#34;da475fac888cf16bc86a42c2b9bee6db460624a6ba674f3cf0357b622af96a71&#34;</span>: plugin type<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;flannel&#34;</span> failed <span style=color:#f92672>(</span>add<span style=color:#f92672>)</span>: incompatible CNI versions; config is <span style=color:#e6db74>&#34;1.0.0&#34;</span>, plugin supports <span style=color:#f92672>[</span><span style=color:#e6db74>&#34;0.1.0&#34;</span> <span style=color:#e6db74>&#34;0.2.0&#34;</span> <span style=color:#e6db74>&#34;0.3.0&#34;</span> <span style=color:#e6db74>&#34;0.3.1&#34;</span> <span style=color:#e6db74>&#34;0.4.0&#34;</span><span style=color:#f92672>]</span>
</span></span></code></pre></div><h3 id=solution-1>Solution</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>cat /var/lib/rancher/k3s/agent/etc/containerd/config.toml
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Check if the soft link of &#34;current&#34; folder matches to the below &#34;bin_dir&#34; folder</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>plugins.<span style=color:#e6db74>&#34;io.containerd.grpc.v1.cri&#34;</span>.cni<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>  bin_dir <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;/var/lib/rancher/k3s/data/ea4b37218d11c27f3eb1c216194bb1a839b6e5c28be33cc92b92bd008bac1ad8/bin&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># If it doesn&#39;t match</span>
</span></span><span style=display:flex><span>sudo rm /var/lib/rancher/k3s/agent/etc/containerd/config.toml.tmpl
</span></span></code></pre></div><h2 id=issue-failed-to-get-sandbox-image>Issue: failed to get sandbox image</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>Warning  FailedCreatePodSandBox  2m4s   kubelet            Failed to create pod sandbox: rpc error: code <span style=color:#f92672>=</span> DeadlineExceeded desc <span style=color:#f92672>=</span> failed to get sandbox image <span style=color:#e6db74>&#34;rancher/mirrored-pause:3.6&#34;</span>: failed to pull image <span style=color:#e6db74>&#34;rancher/mirrored-pause:3.6&#34;</span>: failed to pull and unpack image <span style=color:#e6db74>&#34;docker.io/rancher/mirrored-pause:3.6&#34;</span>: failed to copy: httpReadSeeker: failed open: failed to <span style=color:#66d9ef>do</span> request: Get <span style=color:#e6db74>&#34;https://production.cloudflare.docker.com/registry-v2/docker/registry/v2/blobs/sha256/62/6270bb605e12e581514ada5fd5b3216f727db55dc87d5889c790e4c760683fee/data?verify=1725011232-tD3vGnDILkddFPTG79vdgX7yYCU%!D(MISSING)&#34;</span>: dial tcp 103.73.161.52:443
</span></span></code></pre></div><h3 id=solution-2>Solution</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo vim /etc/containerd/config.toml
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>plugins.<span style=color:#e6db74>&#34;io.containerd.grpc.v1.cri&#34;</span>.registry.mirrors<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>[</span>plugins.<span style=color:#e6db74>&#34;io.containerd.grpc.v1.cri&#34;</span>.registry.mirrors.<span style=color:#e6db74>&#34;docker.io&#34;</span><span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>    endpoint <span style=color:#f92672>=</span> <span style=color:#f92672>[</span><span style=color:#e6db74>&#34;https://atomhub.openatom.cn&#34;</span><span style=color:#f92672>]</span>
</span></span></code></pre></div><h2 id=knowledge>Knowledge</h2><h3 id=ubuntu-18045-lts-dns-settings>Ubuntu 18.04.5 LTS DNS Settings</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo vim /etc/netplan/01-netcfg.yaml
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>network:
</span></span><span style=display:flex><span>  version: <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>  renderer: networkd
</span></span><span style=display:flex><span>  ethernets:
</span></span><span style=display:flex><span>    ens18:
</span></span><span style=display:flex><span>      dhcp4: yes
</span></span><span style=display:flex><span>      nameservers:
</span></span><span style=display:flex><span>        addresses:
</span></span><span style=display:flex><span>          - 114.114.114.114
</span></span><span style=display:flex><span>        search: <span style=color:#f92672>[]</span>
</span></span></code></pre></div><br><p class=back-to-posts><a href=/>[back]</a></p></div><br></div></div></section>