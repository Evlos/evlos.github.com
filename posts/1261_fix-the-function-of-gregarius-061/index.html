<!DOCTYPE html>
<html lang="en-us">

<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	
	<title>Evlos.blog()  | Gregarius 0.6.1 的错误函数修正</title>
	<meta name="viewport" content="width=device-width,minimum-scale=1">
	<meta name="generator" content="Hugo 0.75.1" />
	
	
	<META NAME="ROBOTS" CONTENT="NOINDEX, NOFOLLOW">
	

	
	
	

	

	

	<script async src="https://www.googletagmanager.com/gtag/js?id=UA-66839894-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-66839894-6');
  </script>
</head>

<body>
	

<header>
	<div>
		<nav role="navigation">
	<div>
		<a href="/">
			Evlos.blog()
		</a>
		<div>
			
			
			<ul>
				
				<li>
					<a href="/" title="Home page">
						Home
					</a>
				</li>
				
			</ul>
			
			









		</div>
	</div>
</nav>
	</div>
</header>

	<main role="main">
		

<article>

	<header>
		<p>
			
			POSTS
		</p>
		<h1>Gregarius 0.6.1 的错误函数修正</h1>
		
		<time datetime="2009-12-03T00:47:09&#43;08:00">December 3, 2009</time>
	</header>

	<section><p>以下内容恢复自 Wordpress 时期的数据库备份，内容已经严重过期，仅留作纪念。</p>
<hr>
<p>最近在研究 RSS 聚合程序，个人觉得相对最好的程序是 Gregarius，效率高、负载低、口碑不错。</p>
<p>由于此程序的最后更新时间是 2008-11-26，那就要考虑到新版本PHP不支持函数的问题。</p>
<pre><code>&lt;img src=\&quot;http://www.evlos.org/ev-box/myimg/uploads/Capture0524.jpg\&quot; /&gt;
</code></pre><p>像上图一样，此函数在 PHP 5.3.0 中会被屏蔽，在 PHP 6.0.0 里会被删除掉，同时可被替代。</p>
<p>因为 PHP 团队将删除支持 Portable Operating System Interface (POSIX) 正则表达式的扩展。</p>
<h2 id="1-eregi-函数的语法">1. Eregi 函数的语法：</h2>
<pre><code>int eregi(string pattern,string string [,array regs]);
</code></pre><h2 id="2-eregi-函数的解释">2. Eregi 函数的解释：</h2>
<p>搜寻 string 来和 pattern 的正规表示比对。</p>
<p>若找到比对则会呼叫第三个参数 regs，比对的结果会储存在 regs 的元素之中。</p>
<p>$regs[1] 为符合第一个左边括弧 (parenthesis) 的部份字符串，$regs[2] 为符合第二个括弧的部份字符串。</p>
<p>以此类推，$regs[0] 为参数 string。</p>
<p>如果 ereg() 找到比对，则 $regs 会被十个元素来填满，即使是多于或少于十个括弧内的部份字符串。</p>
<p>也可以比对，这将不影响 ereg() 去比对更多部份字符串的能力。如果比对不到，$regs 将不会被 ereg() 改变。</p>
<p>搜寻是<strong>不区分大小写</strong>的。</p>
<p>如果在 string 中比对到 pattern 则传回 true，如果比对不到或是发生错误则传回 false。</p>
<h2 id="3-eregi-函数的官方范例">3. Eregi 函数的官方范例：</h2>
<pre><code>&lt;?php
    $date=\&quot;2009-02-12\&quot;;
    if (ereg (\&quot;([0-9]{4})-([0-9]{1,2})-([0-9]{1,2})\&quot;, $date, $regs)) {
          echo \&quot;$regs[3].$regs[2].$regs[1]\&quot;;
    }
       else {
               echo \&quot;Invalid date format: $date\&quot;;
       }
?&gt;
</code></pre><p>以上的范例会将日期格式 YYYY-MM-DD 切断，并且把它显示成 DD.MM.YYYY 的格式。</p>
<h2 id="4-如何使用新的函数">4. 如何使用新的函数：</h2>
<p>新的函数是 preg_match()，语法如下。</p>
<pre><code>int preg_match ( string $pattern , string $subject [,
array &amp;$matches [, int $flags [, int $offset ]]] )
</code></pre><h2 id="5-如何修复-gregarius-061">5. 如何修复 Gregarius 0.6.1：</h2>
<pre><code>function getPath($path=\'\') {
    static $ret;
    if ($ret === NULL) {
        $ret = dirname($_SERVER[\'PHP_SELF\']);
        if (defined(\'RSS_FILE_LOCATION\') &amp;&amp; eregi(RSS_FILE_LOCATION.\&quot;\\$\&quot;, $ret)) {
            $ret = substr($ret, 0, strlen($ret) - strlen(RSS_FILE_LOCATION));
        }
        if (substr($ret, -1) == \&quot;\\\\\&quot;) { // Take off trailing backslash
            $ret = substr($ret, 0, -1);
        }
        if (substr($ret, -1) != \&quot;/\&quot;) {  // Add a frontslash
            $ret .= \&quot;/\&quot;;
        }
    }
    return $ret . $path;
}
$dummy = getPath();
</code></pre><pre><code>eregi(RSS_FILE_LOCATION.\&quot;\\$\&quot;, $ret)
</code></pre><p>以上的函数修复如下，即把 POSIX 表达式修改成 PCRE 表达式：</p>
<pre><code>preg_match(RSS_FILE_LOCATION.\&quot;\\$/i\&quot;, $ret)
</code></pre><ul>
	
</ul></section>

	<aside>



</aside>

</article>

<p class="back-to-posts"><a href="/">[back]</a></p>

	</main>
	<footer role="contentinfo">
	<br />
	&copy; 2017-2020 <a href="/">Evlos.blog()</a>
  <p>Theme: CSS-every-working-day-but-not-today made by Evlos.</p>
	<div>








</div>
</footer>

	

</body>

</html>