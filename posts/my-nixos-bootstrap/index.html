<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="chrome=1"><meta name=HandheldFriendly content="True"><meta name=MobileOptimized content="320"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><meta name=description content="Git repo: https://github.com/Evlos/my-nixos-bootstrap
For nix-install only since nix-anywhere does not accept optional substituter.
home.nix The &ldquo;stateVersion&rdquo; should be replaced with the latest one.
{ config, pkgs, ... }: { home.username = &#34;evlos&#34;; home.homeDirectory = &#34;/home/evlos&#34;; home.packages = with pkgs;[ ]; home.stateVersion = &#34;23.05&#34;; programs.home-manager.enable = true; } Makefile Use the domestic mirror to accelerate downloads. After installation, remember to change the password.
default: nixos-install -vvv --option substituters &#34;https://mirrors.cernet.edu.cn/nix-channels/store&#34; nixos-enter --root '/mnt' passwd evlos flake."><meta property="og:title" content="My Nixos Bootstrap"><meta property="og:description" content="Git repo: https://github.com/Evlos/my-nixos-bootstrap
For nix-install only since nix-anywhere does not accept optional substituter.
home.nix The &ldquo;stateVersion&rdquo; should be replaced with the latest one.
{ config, pkgs, ... }: { home.username = &#34;evlos&#34;; home.homeDirectory = &#34;/home/evlos&#34;; home.packages = with pkgs;[ ]; home.stateVersion = &#34;23.05&#34;; programs.home-manager.enable = true; } Makefile Use the domestic mirror to accelerate downloads. After installation, remember to change the password.
default: nixos-install -vvv --option substituters &#34;https://mirrors.cernet.edu.cn/nix-channels/store&#34; nixos-enter --root '/mnt' passwd evlos flake."><meta property="og:type" content="article"><meta property="og:url" content="/posts/my-nixos-bootstrap/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-12-30T23:57:24+08:00"><meta property="article:modified_time" content="2024-12-30T23:57:24+08:00"><title>My Nixos Bootstrap</title><link rel=canonical href=/posts/my-nixos-bootstrap/><script async src="https://www.googletagmanager.com/gtag/js?id=UA-66839894-6"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","UA-66839894-6")</script><style type=text/css>pre{width:100%;overflow:hidden}img{max-width:90%}h2{color:#b3befe}a{color:#aaa;text-decoration:none}a:hover{text-decoration:underline}li.post-item{color:#6b6f84}li.post-item .meta{font-size:85%;padding-right:2px}li.post-item a{font-family:monospace;font-size:110%;color:#b3befe}body{background-color:#333;color:#eee}pre{background-color:#272822}code{max-width:98%;text-wrap-mode:wrap}footer{color:#555}header h1{text-transform:uppercase;font-family:monospace;background:#3facfe;color:rgba(255,255,255,.8);display:inline-block;margin:2px;padding:0 8px}</style></head><body lang><section class="main post"><div class=container><div class=content><div class=front-matter><div class=title-container><h2>My Nixos Bootstrap</h2></div><div class=meta><div class=date title='Mon Dec 30 2024 23:57:24 +0800'>Dec 30, 2024</div><div class=reading-time><div class=middot></div></div></div></div><div class=markdown><p>Git repo: <a href=https://github.com/Evlos/my-nixos-bootstrap>https://github.com/Evlos/my-nixos-bootstrap</a></p><blockquote><p>For nix-install only since nix-anywhere does not accept optional substituter.</p></blockquote><h2 id=homenix>home.nix</h2><p>The &ldquo;stateVersion&rdquo; should be replaced with the latest one.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nix data-lang=nix><span style=display:flex><span>{ config<span style=color:#f92672>,</span> pkgs<span style=color:#f92672>,</span> <span style=color:#f92672>...</span> }:
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>  home<span style=color:#f92672>.</span>username <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;evlos&#34;</span>;
</span></span><span style=display:flex><span>  home<span style=color:#f92672>.</span>homeDirectory <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;/home/evlos&#34;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  home<span style=color:#f92672>.</span>packages <span style=color:#f92672>=</span> <span style=color:#66d9ef>with</span> pkgs;[
</span></span><span style=display:flex><span>  ];
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  home<span style=color:#f92672>.</span>stateVersion <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;23.05&#34;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  programs<span style=color:#f92672>.</span>home-manager<span style=color:#f92672>.</span>enable <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=makefile>Makefile</h2><p>Use the domestic mirror to accelerate downloads. After installation, remember to change the password.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>default:
</span></span><span style=display:flex><span>	nixos-install -vvv --option substituters <span style=color:#e6db74>&#34;https://mirrors.cernet.edu.cn/nix-channels/store&#34;</span>
</span></span><span style=display:flex><span>	nixos-enter --root <span style=color:#e6db74>&#39;/mnt&#39;</span>
</span></span><span style=display:flex><span>	passwd evlos
</span></span></code></pre></div><h2 id=flakenix>flake.nix</h2><p>The following configuration has been simplified as much as possible to allow you to apply your own configuration after installation.</p><p>The &ldquo;disko&rdquo; parts are optional.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nix data-lang=nix><span style=display:flex><span>{
</span></span><span style=display:flex><span>  description <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Evlos&#39; Flake&#34;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  nixConfig <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>    experimental-features <span style=color:#f92672>=</span> [ <span style=color:#e6db74>&#34;nix-command&#34;</span> <span style=color:#e6db74>&#34;flakes&#34;</span> ];
</span></span><span style=display:flex><span>    substituters <span style=color:#f92672>=</span> [
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;https://mirrors.ustc.edu.cn/nix-channels/store&#34;</span>
</span></span><span style=display:flex><span>    ];
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    extra-substituters <span style=color:#f92672>=</span> [
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;https://nix-community.cachix.org&#34;</span>
</span></span><span style=display:flex><span>    ];
</span></span><span style=display:flex><span>    extra-trusted-public-keys <span style=color:#f92672>=</span> [
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;nix-community.cachix.org-1:mB9FSh9qf2dCimDSUo8Zy7bkq5CX+/rkCWyvRCYg3Fs=&#34;</span>
</span></span><span style=display:flex><span>    ];
</span></span><span style=display:flex><span>  };
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  inputs <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>    nixpkgs<span style=color:#f92672>.</span>url <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;github:nixos/nixpkgs/nixos-unstable&#34;</span>;
</span></span><span style=display:flex><span>    disko<span style=color:#f92672>.</span>url <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;github:nix-community/disko&#34;</span>;
</span></span><span style=display:flex><span>    disko<span style=color:#f92672>.</span>inputs<span style=color:#f92672>.</span>nixpkgs<span style=color:#f92672>.</span>follows <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;nixpkgs&#34;</span>;
</span></span><span style=display:flex><span>    home-manager <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>      url <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;github:nix-community/home-manager&#34;</span>;
</span></span><span style=display:flex><span>      inputs<span style=color:#f92672>.</span>nixpkgs<span style=color:#f92672>.</span>follows <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;nixpkgs&#34;</span>;
</span></span><span style=display:flex><span>    };
</span></span><span style=display:flex><span>  };
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  outputs <span style=color:#f92672>=</span> inputs<span style=color:#f92672>@</span>{ nixpkgs<span style=color:#f92672>,</span> home-manager<span style=color:#f92672>,</span> <span style=color:#f92672>...</span> }: {
</span></span><span style=display:flex><span>    nixosConfigurations <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>      dnscore <span style=color:#f92672>=</span> nixpkgs<span style=color:#f92672>.</span>lib<span style=color:#f92672>.</span>nixosSystem {
</span></span><span style=display:flex><span>        system <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;x86_64-linux&#34;</span>;
</span></span><span style=display:flex><span>        modules <span style=color:#f92672>=</span> [
</span></span><span style=display:flex><span>          <span style=color:#e6db74>./configuration.nix</span>
</span></span><span style=display:flex><span>          home-manager<span style=color:#f92672>.</span>nixosModules<span style=color:#f92672>.</span>home-manager
</span></span><span style=display:flex><span>          {
</span></span><span style=display:flex><span>            home-manager<span style=color:#f92672>.</span>useGlobalPkgs <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>;
</span></span><span style=display:flex><span>            home-manager<span style=color:#f92672>.</span>useUserPackages <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>;
</span></span><span style=display:flex><span>            home-manager<span style=color:#f92672>.</span>users<span style=color:#f92672>.</span>evlos <span style=color:#f92672>=</span> <span style=color:#f92672>import</span> <span style=color:#e6db74>./home.nix</span>;
</span></span><span style=display:flex><span>          }
</span></span><span style=display:flex><span>        ];
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      };
</span></span><span style=display:flex><span>    };
</span></span><span style=display:flex><span>  };
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=configurationnix>configuration.nix</h2><p>The &ldquo;hostName&rdquo;, ssh key, and time zone should all be replaced with your own corresponding values.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nix data-lang=nix><span style=display:flex><span>{ config<span style=color:#f92672>,</span> pkgs<span style=color:#f92672>,</span> lib<span style=color:#f92672>,</span> <span style=color:#f92672>...</span> }:
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>  imports <span style=color:#f92672>=</span>
</span></span><span style=display:flex><span>    [
</span></span><span style=display:flex><span>      <span style=color:#e6db74>./hardware-configuration.nix</span>
</span></span><span style=display:flex><span>    ];
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  boot<span style=color:#f92672>.</span>loader<span style=color:#f92672>.</span>grub <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>    enable <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>;
</span></span><span style=display:flex><span>    efiSupport <span style=color:#f92672>=</span> <span style=color:#66d9ef>false</span>;
</span></span><span style=display:flex><span>    device <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;/dev/sda&#34;</span>;
</span></span><span style=display:flex><span>  };
</span></span><span style=display:flex><span>  fileSystems<span style=color:#f92672>.</span><span style=color:#e6db74>&#34;/&#34;</span><span style=color:#f92672>.</span>device <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;/dev/disk/by-label/nixos&#34;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  networking<span style=color:#f92672>.</span>hostName <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;&#34;</span>; <span style=color:#75715e># TODO: fill in</span>
</span></span><span style=display:flex><span>  networking<span style=color:#f92672>.</span>networkmanager<span style=color:#f92672>.</span>enable <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  time<span style=color:#f92672>.</span>timeZone <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Asia/Shanghai&#34;</span>;
</span></span><span style=display:flex><span>  i18n<span style=color:#f92672>.</span>defaultLocale <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;en_US.UTF-8&#34;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  nix<span style=color:#f92672>.</span>settings<span style=color:#f92672>.</span>experimental-features <span style=color:#f92672>=</span> [
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;nix-command&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;flakes&#34;</span>
</span></span><span style=display:flex><span>  ];
</span></span><span style=display:flex><span>  nix<span style=color:#f92672>.</span>settings<span style=color:#f92672>.</span>substituters <span style=color:#f92672>=</span> lib<span style=color:#f92672>.</span>mkForce [
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;https://mirrors.ustc.edu.cn/nix-channels/store&#34;</span>
</span></span><span style=display:flex><span>  ];
</span></span><span style=display:flex><span>  nix<span style=color:#f92672>.</span>settings<span style=color:#f92672>.</span>trusted-users <span style=color:#f92672>=</span> [ <span style=color:#e6db74>&#34;evlos&#34;</span> ];
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  users<span style=color:#f92672>.</span>users<span style=color:#f92672>.</span>evlos <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>    isNormalUser <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>;
</span></span><span style=display:flex><span>    extraGroups <span style=color:#f92672>=</span> [ <span style=color:#e6db74>&#34;networkmanager&#34;</span> <span style=color:#e6db74>&#34;wheel&#34;</span> <span style=color:#e6db74>&#34;docker&#34;</span> ];
</span></span><span style=display:flex><span>    openssh<span style=color:#f92672>.</span>authorizedKeys<span style=color:#f92672>.</span>keys <span style=color:#f92672>=</span> [
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIKQ8q1i5or0ARt3wqkEr3g7JW7jvQZ0IsXQOauSgMXAJ evlos@flamebook&#34;</span>
</span></span><span style=display:flex><span>    ];
</span></span><span style=display:flex><span>  };
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  services<span style=color:#f92672>.</span>openssh <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>    enable <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>;
</span></span><span style=display:flex><span>    settings <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>      PermitRootLogin <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;no&#34;</span>;
</span></span><span style=display:flex><span>      PasswordAuthentication <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>;
</span></span><span style=display:flex><span>    };
</span></span><span style=display:flex><span>    openFirewall <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>;
</span></span><span style=display:flex><span>  };
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  environment<span style=color:#f92672>.</span>systemPackages <span style=color:#f92672>=</span> <span style=color:#66d9ef>with</span> pkgs; [
</span></span><span style=display:flex><span>    curl
</span></span><span style=display:flex><span>    git
</span></span><span style=display:flex><span>  ];
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  system<span style=color:#f92672>.</span>stateVersion <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;23.05&#34;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><br><p class=back-to-posts><a href=/>[back]</a></p></div><br></div></div></section>