<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="chrome=1"><meta name=HandheldFriendly content="True"><meta name=MobileOptimized content="320"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><meta name=description content="以下内容恢复自 Wordpress 时期的数据库备份，内容已经严重过期，仅留作纪念。
请注意，这个程序只为演示 AJAX，没有做任何的重复投票防护。此文主要介绍如何实现多项投票的方法，以及非常简单的 jQuery 局部刷新的应用方法。
一. jQuery多项投票演示： 演示地址： http://www.evlos.org/ev-box/demo/ajax_005
二. jQuery多项投票代码： //这里我只是把和原先那次有明显区别，并且作用较大的代码贴出来作一些说明 //如果有更多疑问，请查看原先的文章，如果还觉得迷糊，请留言询问即可 function getdata() { global $dbfile; $data = file_get_contents($dbfile); $array = explode('|',$data); // 把数据以 | 为分隔，分割到数组 return $array; } // 在 index.php 使用这个函数的来只是读取投票数据 &#34;0|0|0|0|0|0|0|0|0&#34; function showlist() { global $votenum,$votes; $data = getdata(); function is_odd($num){ // 判断偶数的方法 return (is_numeric($num)&($num&amp;1)); } // 实际上后来我并没有使用判断结果，因为觉得没必要以颜色分行 for ($i=0;$i<$votenum;$i++) { if (is_odd($i)) { $trclass = 'odd'; } else { $trclass = 'even'; } echo '<tr id=&#34;vote_'."><meta property="og:title" content="jQuery多项投票演示与局部刷新演示"><meta property="og:description" content="以下内容恢复自 Wordpress 时期的数据库备份，内容已经严重过期，仅留作纪念。
请注意，这个程序只为演示 AJAX，没有做任何的重复投票防护。此文主要介绍如何实现多项投票的方法，以及非常简单的 jQuery 局部刷新的应用方法。
一. jQuery多项投票演示： 演示地址： http://www.evlos.org/ev-box/demo/ajax_005
二. jQuery多项投票代码： //这里我只是把和原先那次有明显区别，并且作用较大的代码贴出来作一些说明 //如果有更多疑问，请查看原先的文章，如果还觉得迷糊，请留言询问即可 function getdata() { global $dbfile; $data = file_get_contents($dbfile); $array = explode('|',$data); // 把数据以 | 为分隔，分割到数组 return $array; } // 在 index.php 使用这个函数的来只是读取投票数据 &#34;0|0|0|0|0|0|0|0|0&#34; function showlist() { global $votenum,$votes; $data = getdata(); function is_odd($num){ // 判断偶数的方法 return (is_numeric($num)&($num&amp;1)); } // 实际上后来我并没有使用判断结果，因为觉得没必要以颜色分行 for ($i=0;$i<$votenum;$i++) { if (is_odd($i)) { $trclass = 'odd'; } else { $trclass = 'even'; } echo '<tr id=&#34;vote_'."><meta property="og:type" content="article"><meta property="og:url" content="/posts/1975_jquery-more-votes/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2010-07-26T06:01:40+08:00"><meta property="article:modified_time" content="2010-07-26T06:01:40+08:00"><title>jQuery多项投票演示与局部刷新演示</title><link rel=canonical href=/posts/1975_jquery-more-votes/><script async src="https://www.googletagmanager.com/gtag/js?id=UA-66839894-6"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","UA-66839894-6")</script><style type=text/css>pre{width:100%;overflow:hidden}img{max-width:90%}h2{color:#b3befe;text-transform:uppercase;font-family:fangsong,sans-serif}a{color:#aaa;text-decoration:none}a:hover{text-decoration:underline}li.post-item{color:#6b6f84}li.post-item .meta{font-size:85%;padding-right:2px}li.post-item a{font-family:monospace;font-size:110%;color:#b3befe}body{background-color:#333;color:#eee}pre{background-color:#272822}code{max-width:98%;text-wrap-mode:wrap}footer{color:#555}header h1{text-transform:uppercase;font-family:monospace;background:#3facfe;color:rgba(255,255,255,.8);display:inline-block;margin:2px;padding:0 8px}</style></head><body lang><section class="main post"><div class=container><div class=content><div class=front-matter><div class=title-container><h2>jQuery多项投票演示与局部刷新演示</h2></div><div class=meta><div class=date title='Mon Jul 26 2010 06:01:40 +0800'>Jul 26, 2010</div><div class=reading-time><div class=middot></div></div></div></div><div class=markdown><blockquote><p>以下内容恢复自 Wordpress 时期的数据库备份，内容已经严重过期，仅留作纪念。</p></blockquote><hr><p>请注意，这个程序只为演示 AJAX，没有做任何的重复投票防护。此文主要介绍如何实现多项投票的方法，以及非常简单的 jQuery 局部刷新的应用方法。</p><h2 id=一-jquery多项投票演示>一. jQuery多项投票演示：</h2><p>演示地址： <a href=http://www.evlos.org/ev-box/demo/ajax_005>http://www.evlos.org/ev-box/demo/ajax_005</a></p><h2 id=二-jquery多项投票代码>二. jQuery多项投票代码：</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#75715e>//这里我只是把和原先那次有明显区别，并且作用较大的代码贴出来作一些说明
</span></span></span><span style=display:flex><span><span style=color:#75715e>//如果有更多疑问，请查看原先的文章，如果还觉得迷糊，请留言询问即可
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>getdata</span>() {
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>global</span> $dbfile;
</span></span><span style=display:flex><span>	$data <span style=color:#f92672>=</span> <span style=color:#a6e22e>file_get_contents</span>($dbfile);
</span></span><span style=display:flex><span>	$array <span style=color:#f92672>=</span> <span style=color:#a6e22e>explode</span>(<span style=color:#e6db74>&#39;|&#39;</span>,$data); <span style=color:#75715e>// 把数据以 | 为分隔，分割到数组
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#66d9ef>return</span> $array;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 在 index.php 使用这个函数的来只是读取投票数据 &#34;0|0|0|0|0|0|0|0|0&#34;
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>showlist</span>() {
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>global</span> $votenum,$votes;
</span></span><span style=display:flex><span>	$data <span style=color:#f92672>=</span> <span style=color:#a6e22e>getdata</span>();
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>function</span> <span style=color:#a6e22e>is_odd</span>($num){ <span style=color:#75715e>// 判断偶数的方法
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>		<span style=color:#66d9ef>return</span> (<span style=color:#a6e22e>is_numeric</span>($num)<span style=color:#f92672>&amp;</span>($num<span style=color:#f92672>&amp;</span><span style=color:#ae81ff>1</span>));
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#75715e>// 实际上后来我并没有使用判断结果，因为觉得没必要以颜色分行
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#66d9ef>for</span> ($i<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>;$i<span style=color:#f92672>&lt;</span>$votenum;$i<span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>is_odd</span>($i)) { $trclass <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;odd&#39;</span>; } <span style=color:#66d9ef>else</span> { $trclass <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;even&#39;</span>; }
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>echo</span> <span style=color:#e6db74>&#39;&lt;tr id=&#34;vote_&#39;</span><span style=color:#f92672>.</span>($i<span style=color:#f92672>+</span><span style=color:#ae81ff>1</span>)<span style=color:#f92672>.</span><span style=color:#e6db74>&#39;&#34; class=&#34;&#39;</span><span style=color:#f92672>.</span>$trclass<span style=color:#f92672>.</span><span style=color:#e6db74>&#39;&#34;&gt;&lt;td class=&#34;gray&#34;&gt;#&#39;</span><span style=color:#f92672>.</span>($i<span style=color:#f92672>+</span><span style=color:#ae81ff>1</span>)<span style=color:#f92672>.</span><span style=color:#e6db74>&#39;&lt;/td&gt;&lt;td&gt;&#39;</span><span style=color:#f92672>.</span>$votes[$i]<span style=color:#f92672>.</span><span style=color:#e6db74>&#39;&lt;/td&gt;&lt;td class=&#34;gray&#34;&gt;已有 &lt;span class=&#34;count vote_&#39;</span><span style=color:#f92672>.</span>($i<span style=color:#f92672>+</span><span style=color:#ae81ff>1</span>)<span style=color:#f92672>.</span><span style=color:#e6db74>&#39;&#34;&gt;&#39;</span><span style=color:#f92672>.</span>$data[$i]<span style=color:#f92672>.</span><span style=color:#e6db74>&#39;&lt;/span票&lt;/td&gt;&lt;td class=&#34;gray warn&#34;&gt;已投票&lt;/td&gt;&lt;td class=&#34;gray button&#34;&gt;[投票]&lt;/td&gt;&lt;/tr&gt;&#39;</span><span style=color:#f92672>.</span><span style=color:#e6db74>&#34;\
</span></span></span><span style=display:flex><span><span style=color:#e6db74>&#34;</span>;
</span></span><span style=display:flex><span>		<span style=color:#75715e>// 这里给每一行的数据附一个 id，内容为 &#34;vote_投票编号&#34;
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>		<span style=color:#75715e>// 我们靠 class=&#34;count&#34; 来找到投票数，靠 warn 和 button 来变换投票前后显示文字
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	}
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#75715e>// 在 index.php 使用这个函数来输出投票列表
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>$votenum <span style=color:#f92672>=</span> <span style=color:#a6e22e>count</span>($votes);
</span></span><span style=display:flex><span><span style=color:#75715e>// 在 config.php 里面的这个语句用来统计数组包含的数量
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>$ivote <span style=color:#f92672>=</span> $_POST[<span style=color:#e6db74>&#39;ivote&#39;</span>];
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> ($i<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>;$i<span style=color:#f92672>&lt;=</span>$votenum;$i<span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> ($ivote<span style=color:#f92672>==</span><span style=color:#e6db74>&#39;vote_&#39;</span><span style=color:#f92672>.</span>$i) {
</span></span><span style=display:flex><span>		$res <span style=color:#f92672>=</span> $i;
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#75715e>// 在 vote.php 使用这个循环来判断用户所投的票，Post来的数据为 vote_1 vote_2 等
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#a6e22e>$</span>(document).<span style=color:#a6e22e>ready</span>(<span style=color:#66d9ef>function</span>(){
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>$</span>(<span style=color:#e6db74>&#34;#vote .button&#34;</span>).<span style=color:#a6e22e>click</span>( <span style=color:#75715e>// 先找到按键元素，即 &#34;投票&#34; 文字处
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>		<span style=color:#66d9ef>function</span>() {
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>var</span> <span style=color:#a6e22e>votesorder</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>$</span>(<span style=color:#66d9ef>this</span>).<span style=color:#a6e22e>parent</span>().<span style=color:#a6e22e>attr</span>(<span style=color:#e6db74>&#34;id&#34;</span>); <span style=color:#75715e>// 取父元素的 id 来判断当前所投何票
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>			<span style=color:#66d9ef>var</span> <span style=color:#a6e22e>count</span><span style=color:#f92672>=</span>eval(<span style=color:#a6e22e>$</span>(<span style=color:#e6db74>&#34;#vote .&#34;</span><span style=color:#f92672>+</span><span style=color:#a6e22e>votesorder</span>).<span style=color:#a6e22e>text</span>())<span style=color:#f92672>+</span><span style=color:#ae81ff>1</span>; <span style=color:#75715e>// 然后对其票数加一
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>			<span style=color:#a6e22e>$</span>(<span style=color:#e6db74>&#34;#vote .&#34;</span><span style=color:#f92672>+</span><span style=color:#a6e22e>votesorder</span>).<span style=color:#a6e22e>css</span>(<span style=color:#e6db74>&#34;color&#34;</span>,<span style=color:#e6db74>&#34;green&#34;</span>).<span style=color:#a6e22e>text</span>(<span style=color:#a6e22e>count</span>); <span style=color:#75715e>// 显示加一后的票数并变色
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>			<span style=color:#a6e22e>$</span>(<span style=color:#e6db74>&#34;#vote .button&#34;</span>).<span style=color:#a6e22e>css</span>(<span style=color:#e6db74>&#34;display&#34;</span>,<span style=color:#e6db74>&#34;none&#34;</span>); <span style=color:#75715e>// 隐藏 &#34;投票&#34;
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>			<span style=color:#a6e22e>$</span>(<span style=color:#e6db74>&#34;#vote .warn&#34;</span>).<span style=color:#a6e22e>css</span>(<span style=color:#e6db74>&#34;display&#34;</span>,<span style=color:#e6db74>&#34;inline&#34;</span>); <span style=color:#75715e>// 显示 &#34;已投票&#34;
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>			<span style=color:#a6e22e>$</span>.<span style=color:#a6e22e>ajax</span>({
</span></span><span style=display:flex><span>				<span style=color:#a6e22e>type</span><span style=color:#f92672>:</span><span style=color:#e6db74>&#39;POST&#39;</span>,
</span></span><span style=display:flex><span>				<span style=color:#a6e22e>dataType</span><span style=color:#f92672>:</span><span style=color:#e6db74>&#39;text&#39;</span>,
</span></span><span style=display:flex><span>				<span style=color:#a6e22e>url</span><span style=color:#f92672>:</span><span style=color:#e6db74>&#39;vote.php&#39;</span>,
</span></span><span style=display:flex><span>				<span style=color:#a6e22e>data</span><span style=color:#f92672>:</span><span style=color:#e6db74>&#39;ivote=&#39;</span><span style=color:#f92672>+</span><span style=color:#a6e22e>votesorder</span>
</span></span><span style=display:flex><span>			});
</span></span><span style=display:flex><span>			<span style=color:#75715e>// Post发送数据，类型 text，送给 vote.php，内容为父元素的 id
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>			<span style=color:#75715e>/* $.cookie(&#39;vote_s81jaj881jja&#39;, &#39;yes&#39;, { expires: 3 }); */</span>
</span></span><span style=display:flex><span>			<span style=color:#75715e>// 此处未校验 CSRF
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>		}
</span></span><span style=display:flex><span>	);
</span></span><span style=display:flex><span>});
</span></span></code></pre></div><h2 id=三-局部刷新预习>三. 局部刷新预习：</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#a6e22e>$</span>(document).<span style=color:#a6e22e>ready</span>(<span style=color:#66d9ef>function</span>(){
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>$</span>(<span style=color:#e6db74>&#34;#box .button&#34;</span>).<span style=color:#a6e22e>click</span>(
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>function</span>() {
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>data</span><span style=color:#f92672>=</span><span style=color:#a6e22e>$</span>.<span style=color:#a6e22e>ajax</span>({<span style=color:#a6e22e>url</span><span style=color:#f92672>:</span><span style=color:#e6db74>&#34;time.php&#34;</span>,<span style=color:#66d9ef>async</span><span style=color:#f92672>:</span><span style=color:#66d9ef>false</span>});
</span></span><span style=display:flex><span>			<span style=color:#75715e>/* async表示禁止异步请求，因为我们接下来就要使用返回的数据 */</span>
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>$</span>(<span style=color:#e6db74>&#34;#box .target&#34;</span>).<span style=color:#a6e22e>html</span>(<span style=color:#a6e22e>data</span>.<span style=color:#a6e22e>responseText</span>);
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>	);
</span></span><span style=display:flex><span>});
</span></span></code></pre></div><p>简单的当前秒数局部刷新演示地址 <a href=http://www.evlos.org/ev-box/demo/ajax_006>http://www.evlos.org/ev-box/demo/ajax_006</a></p><h2 id=四-演示程序下载>四. 演示程序下载：</h2><p>首先是前面的 jQuery 多项投票演示程序的下载地址，后面则是 jQuery 预习演示程序的下载地址。</p><ul><li><a href="http://code.google.com/p/evlosbox/downloads/detail?name=jquery-more-votes-example-v1.zip">http://code.google.com/p/evlosbox/downloads/detail?name=jquery-more-votes-example-v1.zip</a></li><li><a href="http://code.google.com/p/evlosbox/downloads/detail?name=jq-areafresh-easy-v1.zip">http://code.google.com/p/evlosbox/downloads/detail?name=jq-areafresh-easy-v1.zip</a></li></ul><h2 id=五-附言>五. 附言：</h2><p>虽然我已经在代码中注释说这个程序没有做严格防护，但是仍然很感谢报告 BUG 的盆友。</p><br><p class=back-to-posts><a href=/>[back]</a></p></div><br></div></div></section>