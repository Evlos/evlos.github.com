<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="chrome=1"><meta name=HandheldFriendly content="True"><meta name=MobileOptimized content="320"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><meta name=description content="Oracle Cloud has network layer issue with VxLAN
Uninstallation k3s-uninstall.sh k3s-agent-uninstall.sh sudo iptables -F && sudo iptables -t nat -F && sudo iptables -t mangle -F && sudo iptables -X && sudo iptables -L Installation curl -sfL https://get.k3s.io | sh - k3s kubectl get node sudo cat /var/lib/rancher/k3s/server/node-token sudo cat /etc/rancher/k3s/k3s.yaml vim ~/.kube/config # insecure-skip-tls-verify: true curl -sfL https://get.k3s.io | K3S_URL=https://10.0.0.134:6443 K3S_TOKEN=mynodetoken sh - sudo kubectl get node -w sudo kubectl apply -f config/eternalelf_tls_cert."><meta property="og:title" content="K3s Installation"><meta property="og:description" content="Oracle Cloud has network layer issue with VxLAN
Uninstallation k3s-uninstall.sh k3s-agent-uninstall.sh sudo iptables -F && sudo iptables -t nat -F && sudo iptables -t mangle -F && sudo iptables -X && sudo iptables -L Installation curl -sfL https://get.k3s.io | sh - k3s kubectl get node sudo cat /var/lib/rancher/k3s/server/node-token sudo cat /etc/rancher/k3s/k3s.yaml vim ~/.kube/config # insecure-skip-tls-verify: true curl -sfL https://get.k3s.io | K3S_URL=https://10.0.0.134:6443 K3S_TOKEN=mynodetoken sh - sudo kubectl get node -w sudo kubectl apply -f config/eternalelf_tls_cert."><meta property="og:type" content="article"><meta property="og:url" content="/posts/k3s_installation/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-11-18T12:33:09+08:00"><meta property="article:modified_time" content="2022-11-18T12:33:09+08:00"><title>K3s Installation</title><link rel=canonical href=/posts/k3s_installation/><script async src="https://www.googletagmanager.com/gtag/js?id=UA-66839894-6"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","UA-66839894-6")</script></head><body lang><section class="main post"><div class=container><div class=content><div class=front-matter><div class=title-container><h2>K3s Installation</h2></div><div class=meta><div class=date title='Fri Nov 18 2022 12:33:09 +0800'>Nov 18, 2022</div><div class=reading-time><div class=middot></div></div></div></div><div class=markdown><p><strong>Oracle Cloud has network layer issue with VxLAN</strong></p><h2 id=uninstallation>Uninstallation</h2><pre tabindex=0><code>k3s-uninstall.sh
k3s-agent-uninstall.sh
sudo iptables -F &amp;&amp; sudo iptables -t nat -F &amp;&amp; sudo iptables -t mangle -F &amp;&amp; sudo iptables -X &amp;&amp; sudo iptables -L
</code></pre><h2 id=installation>Installation</h2><pre tabindex=0><code>curl -sfL https://get.k3s.io | sh -
k3s kubectl get node
sudo cat /var/lib/rancher/k3s/server/node-token
sudo cat /etc/rancher/k3s/k3s.yaml
vim ~/.kube/config
# insecure-skip-tls-verify: true
</code></pre><pre tabindex=0><code>curl -sfL https://get.k3s.io | K3S_URL=https://10.0.0.134:6443 K3S_TOKEN=mynodetoken sh -
</code></pre><pre tabindex=0><code>sudo kubectl get node -w
sudo kubectl apply -f config/eternalelf_tls_cert.yaml
</code></pre><pre tabindex=0><code># skip
cat cloudflare.pem | base64 -w 0
cat cloudflare.key | base64 -w 0
rsync -avzP data_registry/ ubuntu@10.0.0.130:data_registry
</code></pre><h2 id=kilo>Kilo</h2><pre tabindex=0><code>curl -sfL https://get.k3s.io | INSTALL_K3S_EXEC=&#34;--tls-san EXTERNAL_IP --node-external-ip EXTERNAL_IP&#34; sh -

sudo cat /var/lib/rancher/k3s/server/node-token
sudo cat /etc/rancher/k3s/k3s.yaml
insecure-skip-tls-verify: true

kko annotate nodes HOSTNAME_A kilo.squat.ai/force-endpoint=EXTERNAL_IP:51821
kko annotate nodes HOSTNAME_B kilo.squat.ai/force-endpoint=EXTERNAL_IP:51821
kko annotate nodes HOSTNAME_C kilo.squat.ai/force-endpoint=EXTERNAL_IP:51821

kko annotate nodes HOSTNAME_A kilo.squat.ai/location=&#34;jp&#34;
kko annotate nodes HOSTNAME_B kilo.squat.ai/location=&#34;jp&#34;
kko annotate nodes HOSTNAME_C kilo.squat.ai/location=&#34;jp&#34;

ExecStart=/usr/local/bin/k3s \
    server \
        &#39;--tls-san&#39; \
        &#39;EXTERNAL_IP&#39; \
        &#39;--node-externaluninstall-ip&#39; \
        &#39;EXTERNAL_IP&#39;

sudo systemctl daemon-reload
sudo systemctl restart k3s.service

kko apply -f https://raw.githubusercontent.com/squat/kilo/main/manifests/crds.yaml
kko apply -f kilo-k3s.yaml
</code></pre><br><p class=back-to-posts><a href=/>[back]</a></p></div><br></div></div></section>