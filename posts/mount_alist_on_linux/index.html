<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="chrome=1"><meta name=HandheldFriendly content="True"><meta name=MobileOptimized content="320"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><meta name=description content="# install davfs2 sudo apt install davfs2 sudo vim /etc/davfs2/davfs2.conf # ignore_dav_header 1 # read_timeout 7200 # cache_size 128000 # MiByte sudo mkdir /mnt/webdav # test run sudo mount -t davfs https://alist.example.com/dav /mnt/webdav ls -al /mnt/webdav/ # prepare for non-root access sudo vim /etc/fstab # https://alist.example.com/dav /mnt/webdav davfs _netdev,noauto,user 0 0 sudo usermod -a -G davfs2 evlos # re-login groups mount /mnt/webdav rsync -avP /mnt/u/Fonts /mnt/webdav/Fonts --exclude=Thumbs.db --inplace --append --append-verify --size-only --delete --timeout 7200 The issue encountered during the process An error occurs when transferring a large number of files:"><meta property="og:title" content="Mount Alist on Linux"><meta property="og:description" content="# install davfs2 sudo apt install davfs2 sudo vim /etc/davfs2/davfs2.conf # ignore_dav_header 1 # read_timeout 7200 # cache_size 128000 # MiByte sudo mkdir /mnt/webdav # test run sudo mount -t davfs https://alist.example.com/dav /mnt/webdav ls -al /mnt/webdav/ # prepare for non-root access sudo vim /etc/fstab # https://alist.example.com/dav /mnt/webdav davfs _netdev,noauto,user 0 0 sudo usermod -a -G davfs2 evlos # re-login groups mount /mnt/webdav rsync -avP /mnt/u/Fonts /mnt/webdav/Fonts --exclude=Thumbs.db --inplace --append --append-verify --size-only --delete --timeout 7200 The issue encountered during the process An error occurs when transferring a large number of files:"><meta property="og:type" content="article"><meta property="og:url" content="/posts/mount_alist_on_linux/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-12-13T01:28:32+08:00"><meta property="article:modified_time" content="2024-12-13T01:28:32+08:00"><title>Mount Alist on Linux</title><link rel=canonical href=/posts/mount_alist_on_linux/><script async src="https://www.googletagmanager.com/gtag/js?id=UA-66839894-6"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","UA-66839894-6")</script><style type=text/css>pre{width:100%;overflow:hidden}img{max-width:90%}h2{color:#b3befe}a{color:#aaa;text-decoration:none}a:hover{text-decoration:underline}li.post-item{color:#6b6f84}li.post-item .meta{font-size:85%;padding-right:2px}li.post-item a{font-family:monospace;font-size:110%;color:#b3befe}body{background-color:#333;color:#eee}pre{background-color:#272822}code{max-width:98%;text-wrap-mode:wrap}footer{color:#555}header h1{text-transform:uppercase;font-family:monospace;background:#3facfe;color:rgba(255,255,255,.8);display:inline-block;margin:2px;padding:0 8px}</style></head><body lang><section class="main post"><div class=container><div class=content><div class=front-matter><div class=title-container><h2>Mount Alist on Linux</h2></div><div class=meta><div class=date title='Fri Dec 13 2024 01:28:32 +0800'>Dec 13, 2024</div><div class=reading-time><div class=middot></div></div></div></div><div class=markdown><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># install davfs2</span>
</span></span><span style=display:flex><span>sudo apt install davfs2
</span></span><span style=display:flex><span>sudo vim /etc/davfs2/davfs2.conf
</span></span><span style=display:flex><span><span style=color:#75715e># ignore_dav_header 1</span>
</span></span><span style=display:flex><span><span style=color:#75715e># read_timeout 7200</span>
</span></span><span style=display:flex><span><span style=color:#75715e># cache_size 128000 # MiByte</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>sudo mkdir /mnt/webdav
</span></span><span style=display:flex><span><span style=color:#75715e># test run</span>
</span></span><span style=display:flex><span>sudo mount -t davfs https://alist.example.com/dav /mnt/webdav
</span></span><span style=display:flex><span>ls -al /mnt/webdav/
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># prepare for non-root access</span>
</span></span><span style=display:flex><span>sudo vim /etc/fstab
</span></span><span style=display:flex><span><span style=color:#75715e># https://alist.example.com/dav /mnt/webdav davfs _netdev,noauto,user 0 0</span>
</span></span><span style=display:flex><span>sudo usermod -a -G davfs2 evlos
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># re-login</span>
</span></span><span style=display:flex><span>groups
</span></span><span style=display:flex><span>mount /mnt/webdav
</span></span><span style=display:flex><span>rsync -avP /mnt/u/Fonts /mnt/webdav/Fonts --exclude<span style=color:#f92672>=</span>Thumbs.db --inplace --append --append-verify --size-only --delete --timeout <span style=color:#ae81ff>7200</span>
</span></span></code></pre></div><h2 id=the-issue-encountered-during-the-process>The issue encountered during the process</h2><p>An error occurs when transferring a large number of files:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>rsync error: received SIGINT, SIGTERM, or SIGHUP <span style=color:#f92672>(</span>code 20<span style=color:#f92672>)</span> at rsync.c<span style=color:#f92672>(</span>644<span style=color:#f92672>)</span> <span style=color:#f92672>[</span>sender<span style=color:#f92672>=</span>3.1.2<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>rsync: write failed on <span style=color:#e6db74>&#34;/mnt/webdav/Fonts/DFMrm7.ttc&#34;</span>: No space left on device <span style=color:#f92672>(</span>28<span style=color:#f92672>)</span>
</span></span></code></pre></div><p>There are no error logs on <code>kubectl exec -it deployments/alist -- tail -f -n 100 /opt/alist/data/log/log.log</code>.</p><p><img src=https://raw.githubusercontent.com/Evlos/uploads/refs/heads/main/View%20panel%20-%20k8s%20-%20Dashboards%20-%20Grafana%20-%20Google%20Chrome_2024-12-23_01-09-17.jpg alt></p><p>It was observed that Alist stopped transferring after a while, finishing earlier than Rsync, with half of the files successfully transferred.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>&gt; journalctl -xe
</span></span><span style=display:flex><span>Dec <span style=color:#ae81ff>23</span> 01:58:26 console mount.davfs<span style=color:#f92672>[</span>16680<span style=color:#f92672>]</span>: davfs2 1.5.4
</span></span><span style=display:flex><span>Dec <span style=color:#ae81ff>23</span> 01:58:49 console mount.davfs<span style=color:#f92672>[</span>16681<span style=color:#f92672>]</span>: open files exceed max cache size by <span style=color:#ae81ff>13933</span> MiBytes
</span></span><span style=display:flex><span>Dec <span style=color:#ae81ff>23</span> 01:58:59 console mount.davfs<span style=color:#f92672>[</span>16681<span style=color:#f92672>]</span>: open files exceed max cache size by <span style=color:#ae81ff>13933</span> MiBytes
</span></span><span style=display:flex><span>Dec <span style=color:#ae81ff>23</span> 02:08:04 console mount.davfs<span style=color:#f92672>[</span>17086<span style=color:#f92672>]</span>: error writing directory /home/evlos/.davfs2/cache/alist.example.com-dav+mnt-webdav+evlos/dir-Fonts-YvAmnf
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>evlos@console ~&gt; df -lh
</span></span><span style=display:flex><span>/dev/mapper/console--vg-root   31G   29G     <span style=color:#ae81ff>0</span> 100% /
</span></span></code></pre></div><p>It seems I complicated a simple issue :)</p><h3 id=extend-devsda>Extend /dev/sda</h3><p>First, expand the disk size in Proxmox, and then:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>evlos@console ~&gt; sudo parted /dev/sda
</span></span><span style=display:flex><span>GNU Parted 3.2
</span></span><span style=display:flex><span>Using /dev/sda
</span></span><span style=display:flex><span>Welcome to GNU Parted! Type <span style=color:#e6db74>&#39;help&#39;</span> to view a list of commands.
</span></span><span style=display:flex><span><span style=color:#f92672>(</span>parted<span style=color:#f92672>)</span> print
</span></span><span style=display:flex><span>Model: QEMU QEMU HARDDISK <span style=color:#f92672>(</span>scsi<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Disk /dev/sda: 172GB
</span></span><span style=display:flex><span>Sector size <span style=color:#f92672>(</span>logical/physical<span style=color:#f92672>)</span>: 512B/512B
</span></span><span style=display:flex><span>Partition Table: msdos
</span></span><span style=display:flex><span>Disk Flags:
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Number  Start   End     Size    Type     File system  Flags
</span></span><span style=display:flex><span> <span style=color:#ae81ff>1</span>      1049kB  34.4GB  34.4GB  primary               boot, lvm
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>(</span>parted<span style=color:#f92672>)</span> resizepart <span style=color:#ae81ff>1</span> 100%
</span></span><span style=display:flex><span><span style=color:#f92672>(</span>parted<span style=color:#f92672>)</span> quit
</span></span><span style=display:flex><span>Information: You may need to update /etc/fstab.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>evlos@console ~&gt; sudo partprobe /dev/sda
</span></span><span style=display:flex><span>evlos@console ~&gt; sudo pvresize /dev/sda1
</span></span><span style=display:flex><span>  Physical volume <span style=color:#e6db74>&#34;/dev/sda1&#34;</span> changed
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>1</span> physical volume<span style=color:#f92672>(</span>s<span style=color:#f92672>)</span> resized / <span style=color:#ae81ff>0</span> physical volume<span style=color:#f92672>(</span>s<span style=color:#f92672>)</span> not resized
</span></span><span style=display:flex><span>evlos@console ~&gt; sudo vgdisplay
</span></span><span style=display:flex><span>  --- Volume group ---
</span></span><span style=display:flex><span>  VG Name               console-vg
</span></span><span style=display:flex><span>  System ID
</span></span><span style=display:flex><span>  Format                lvm2
</span></span><span style=display:flex><span>  Metadata Areas        <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>  Metadata Sequence No  <span style=color:#ae81ff>5</span>
</span></span><span style=display:flex><span>  VG Access             read/write
</span></span><span style=display:flex><span>  VG Status             resizable
</span></span><span style=display:flex><span>  MAX LV                <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>  Cur LV                <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>  Open LV               <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>  Max PV                <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>  Cur PV                <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>  Act PV                <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>  VG Size               &lt;160.00 GiB
</span></span><span style=display:flex><span>  PE Size               4.00 MiB
</span></span><span style=display:flex><span>  Total PE              <span style=color:#ae81ff>40959</span>
</span></span><span style=display:flex><span>  Alloc PE / Size       <span style=color:#ae81ff>8191</span> / &lt;32.00 GiB
</span></span><span style=display:flex><span>  Free  PE / Size       <span style=color:#ae81ff>32768</span> / 128.00 GiB
</span></span><span style=display:flex><span>  VG UUID               3vPnjM-HCw0-tzPN-6Cwi-xHsH-vCL7-I40UM6
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>evlos@console ~&gt; sudo lvextend -l +100%FREE /dev/mapper/console--vg-root
</span></span><span style=display:flex><span>  Size of logical volume console-vg/root changed from &lt;31.04 GiB <span style=color:#f92672>(</span><span style=color:#ae81ff>7946</span> extents<span style=color:#f92672>)</span> to &lt;159.04 GiB <span style=color:#f92672>(</span><span style=color:#ae81ff>40714</span> extents<span style=color:#f92672>)</span>.
</span></span><span style=display:flex><span>  Logical volume console-vg/root successfully resized.
</span></span><span style=display:flex><span>evlos@console ~&gt; sudo resize2fs /dev/mapper/console--vg-root
</span></span><span style=display:flex><span>resize2fs 1.44.1 <span style=color:#f92672>(</span>24-Mar-2018<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Filesystem at /dev/mapper/console--vg-root is mounted on /; on-line resizing required
</span></span><span style=display:flex><span>old_desc_blocks <span style=color:#f92672>=</span> 4, new_desc_blocks <span style=color:#f92672>=</span> <span style=color:#ae81ff>20</span>
</span></span><span style=display:flex><span>The filesystem on /dev/mapper/console--vg-root is now <span style=color:#ae81ff>41691136</span> <span style=color:#f92672>(</span>4k<span style=color:#f92672>)</span> blocks long.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>evlos@console ~&gt; df -lh
</span></span><span style=display:flex><span>Filesystem                    Size  Used Avail Use% Mounted on
</span></span><span style=display:flex><span>udev                          7.9G     <span style=color:#ae81ff>0</span>  7.9G   0% /dev
</span></span><span style=display:flex><span>tmpfs                         1.4G  736K  1.4G   1% /run
</span></span><span style=display:flex><span>/dev/mapper/console--vg-root  157G   29G  121G  20% /
</span></span><span style=display:flex><span>tmpfs                         4.0G     <span style=color:#ae81ff>0</span>  4.0G   0% /dev/shm
</span></span><span style=display:flex><span>tmpfs                         5.0M     <span style=color:#ae81ff>0</span>  5.0M   0% /run/lock
</span></span><span style=display:flex><span>tmpfs                         4.0G     <span style=color:#ae81ff>0</span>  4.0G   0% /sys/fs/cgroup
</span></span><span style=display:flex><span>tmpfs                         825M     <span style=color:#ae81ff>0</span>  825M   0% /run/user/1000
</span></span></code></pre></div><br><p class=back-to-posts><a href=/>[back]</a></p></div><br></div></div></section>