<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="chrome=1"><meta name=HandheldFriendly content="True"><meta name=MobileOptimized content="320"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><meta name=description content="Prepation (for 1080 Ti) nano /etc/default/grub # modify GRUB_CMDLINE_LINUX_DEFAULT=&#34;quiet intel_iommu=on&#34; nano /etc/modules # append vfio vfio_iommu_type1 vfio_pci vfio_virqfd echo &#34;blacklist radeon&#34; >> /etc/modprobe.d/blacklist.conf echo &#34;blacklist nouveau&#34; >> /etc/modprobe.d/blacklist.conf echo &#34;blacklist nvidia&#34; >> /etc/modprobe.d/blacklist.conf echo &#34;options vfio_iommu_type1 allow_unsafe_interrupts=1&#34; > /etc/modprobe.d/iommu_unsafe_interrupts.conf echo &#34;options kvm ignore_msrs=1&#34; > /etc/modprobe.d/kvm.conf lspci -v | grep VGA 0a:00.0 VGA compatible controller: Matrox Electronics Systems Ltd. G200eR2 (prog-if 00 [VGA controller]) 42:00.0 VGA compatible controller: NVIDIA Corporation GP102 [GeForce GTX 1080 Ti] (rev a1) (prog-if 00 [VGA controller]) lspci -n -s 42:00 echo &#34;options vfio-pci ids=10de:1b06,10de:10ef&#34; > /etc/modprobe."><meta property="og:title" content="Proxmox PCIe Passthrough"><meta property="og:description" content="Prepation (for 1080 Ti) nano /etc/default/grub # modify GRUB_CMDLINE_LINUX_DEFAULT=&#34;quiet intel_iommu=on&#34; nano /etc/modules # append vfio vfio_iommu_type1 vfio_pci vfio_virqfd echo &#34;blacklist radeon&#34; >> /etc/modprobe.d/blacklist.conf echo &#34;blacklist nouveau&#34; >> /etc/modprobe.d/blacklist.conf echo &#34;blacklist nvidia&#34; >> /etc/modprobe.d/blacklist.conf echo &#34;options vfio_iommu_type1 allow_unsafe_interrupts=1&#34; > /etc/modprobe.d/iommu_unsafe_interrupts.conf echo &#34;options kvm ignore_msrs=1&#34; > /etc/modprobe.d/kvm.conf lspci -v | grep VGA 0a:00.0 VGA compatible controller: Matrox Electronics Systems Ltd. G200eR2 (prog-if 00 [VGA controller]) 42:00.0 VGA compatible controller: NVIDIA Corporation GP102 [GeForce GTX 1080 Ti] (rev a1) (prog-if 00 [VGA controller]) lspci -n -s 42:00 echo &#34;options vfio-pci ids=10de:1b06,10de:10ef&#34; > /etc/modprobe."><meta property="og:type" content="article"><meta property="og:url" content="/posts/proxmox-pcie-passthrough/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2021-03-09T18:31:04+08:00"><meta property="article:modified_time" content="2021-03-09T18:31:04+08:00"><title>Proxmox PCIe Passthrough</title><link rel=canonical href=/posts/proxmox-pcie-passthrough/><script async src="https://www.googletagmanager.com/gtag/js?id=UA-66839894-6"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","UA-66839894-6")</script><style type=text/css>pre{width:100%;overflow:hidden}img{max-width:90%}a{color:#aaa}li.post-item .meta{font-size:90%}li.post-item{color:#777}body{background-color:#333;color:#eee}pre{background-color:#272822}code{max-width:98%;text-wrap-mode:wrap}footer{color:#555}</style></head><body lang><section class="main post"><div class=container><div class=content><div class=front-matter><div class=title-container><h2>Proxmox PCIe Passthrough</h2></div><div class=meta><div class=date title='Tue Mar 9 2021 18:31:04 +0800'>Mar 9, 2021</div><div class=reading-time><div class=middot></div></div></div></div><div class=markdown><h2 id=prepation-for-1080-ti>Prepation (for 1080 Ti)</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>nano /etc/default/grub <span style=color:#75715e># modify</span>
</span></span><span style=display:flex><span>GRUB_CMDLINE_LINUX_DEFAULT<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;quiet intel_iommu=on&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>nano /etc/modules <span style=color:#75715e># append</span>
</span></span><span style=display:flex><span>vfio
</span></span><span style=display:flex><span>vfio_iommu_type1
</span></span><span style=display:flex><span>vfio_pci
</span></span><span style=display:flex><span>vfio_virqfd
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;blacklist radeon&#34;</span> &gt;&gt; /etc/modprobe.d/blacklist.conf
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;blacklist nouveau&#34;</span> &gt;&gt; /etc/modprobe.d/blacklist.conf
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;blacklist nvidia&#34;</span> &gt;&gt; /etc/modprobe.d/blacklist.conf
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;options vfio_iommu_type1 allow_unsafe_interrupts=1&#34;</span> &gt; /etc/modprobe.d/iommu_unsafe_interrupts.conf
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;options kvm ignore_msrs=1&#34;</span> &gt; /etc/modprobe.d/kvm.conf
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>lspci -v | grep VGA
</span></span><span style=display:flex><span>0a:00.0 VGA compatible controller: Matrox Electronics Systems Ltd. G200eR2 <span style=color:#f92672>(</span>prog-if <span style=color:#ae81ff>00</span> <span style=color:#f92672>[</span>VGA controller<span style=color:#f92672>])</span>
</span></span><span style=display:flex><span>42:00.0 VGA compatible controller: NVIDIA Corporation GP102 <span style=color:#f92672>[</span>GeForce GTX <span style=color:#ae81ff>1080</span> Ti<span style=color:#f92672>]</span> <span style=color:#f92672>(</span>rev a1<span style=color:#f92672>)</span> <span style=color:#f92672>(</span>prog-if <span style=color:#ae81ff>00</span> <span style=color:#f92672>[</span>VGA controller<span style=color:#f92672>])</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>lspci -n -s 42:00
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;options vfio-pci ids=10de:1b06,10de:10ef&#34;</span> &gt; /etc/modprobe.d/vfio.conf
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>update-grub
</span></span><span style=display:flex><span>update-initramfs
</span></span><span style=display:flex><span>reboot
</span></span></code></pre></div><h2 id=my-working-configuration>My working configuration:</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>bios: ovmf
</span></span><span style=display:flex><span>boot: order<span style=color:#f92672>=</span>scsi0
</span></span><span style=display:flex><span>cores: <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>cpu: host
</span></span><span style=display:flex><span>cpuunits: <span style=color:#ae81ff>2048</span>
</span></span><span style=display:flex><span>efidisk0: local-lvm:vm-105-disk-1,size<span style=color:#f92672>=</span>4M
</span></span><span style=display:flex><span>hostpci0: 42:00,pcie<span style=color:#f92672>=</span>1,x-vga<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>ide2: none,media<span style=color:#f92672>=</span>cdrom
</span></span><span style=display:flex><span>machine: q35
</span></span><span style=display:flex><span>memory: <span style=color:#ae81ff>4096</span>
</span></span><span style=display:flex><span>name: Miner
</span></span><span style=display:flex><span>net0: virtio<span style=color:#f92672>=</span>6E:26:42:2E:63:56,bridge<span style=color:#f92672>=</span>vmbr0,firewall<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>numa: <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>ostype: l26
</span></span><span style=display:flex><span>scsi0: local-lvm:vm-105-disk-0,size<span style=color:#f92672>=</span>1964M
</span></span><span style=display:flex><span>scsihw: virtio-scsi-pci
</span></span><span style=display:flex><span>smbios1: uuid<span style=color:#f92672>=</span>6c867c83-f66b-435d-81a6-863e4eb65979
</span></span><span style=display:flex><span>sockets: <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>vmgenid: 01d0e964-274c-4c52-afe1-369c944779dc
</span></span></code></pre></div><br><p class=back-to-posts><a href=/>[back]</a></p></div><br></div></div></section>